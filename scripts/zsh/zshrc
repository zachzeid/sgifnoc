# sgifnoc zsh configuration
# Interactive shell configuration (.zshrc)
# Environment variables are handled in .zshenv

# pyenv interactive initialization (beyond what's in .zshenv)
if command -v pyenv >/dev/null; then
    eval "$(pyenv init -)"
fi

# Path to oh-my-zsh installation
export ZSH="$HOME/.oh-my-zsh"

# Theme
ZSH_THEME="robbyrussell"

# Plugins
plugins=(
    git
    python
    pyenv
    docker
    zsh-autosuggestions
    zsh-syntax-highlighting
)

# Source oh-my-zsh
if [ -f "$ZSH/oh-my-zsh.sh" ]; then
    source $ZSH/oh-my-zsh.sh
else
    echo "Oh-My-Zsh not found. Please install it: https://ohmyz.sh/"
fi

# Python development settings
export PYTHONDONTWRITEBYTECODE=1  # Prevent Python from writing .pyc files
export PYTHONUNBUFFERED=1         # Prevent Python from buffering stdout and stderr

# Useful aliases
alias py="python"
alias pyv="python -V"
alias pip-upgrade="pip list --outdated --format=freeze | grep -v '^\-e' | cut -d = -f 1 | xargs -n1 pip install -U"
alias piplist="pip list"
alias pipreq="pip freeze > requirements.txt"

# Poetry shortcuts
alias po="poetry"
alias poa="poetry add"
alias poad="poetry add --group dev"
alias por="poetry remove"
alias poi="poetry install"
alias pos="poetry shell"
alias posh="poetry show"
alias poru="poetry run"

# Git shortcuts
alias gs="git status"
alias gp="git pull"
alias gc="git commit"
alias gch="git checkout"
alias gb="git branch"
alias gpr="gh pr create"
alias gprs="gh pr status"
alias gprv="gh pr view"

# Directory shortcuts
alias proj="cd ~/Projects"
alias docs="cd ~/Documents"

# Editor configuration
export EDITOR='vim'

# History configuration
HISTSIZE=10000
SAVEHIST=10000
HISTFILE=~/.zsh_history
setopt appendhistory

# Enable colors
autoload -U colors && colors

# Google Cloud SDK (conditional)
# The next line updates PATH for the Google Cloud SDK.
if [ -f "$HOME/Downloads/google-cloud-sdk/path.zsh.inc" ]; then
    source "$HOME/Downloads/google-cloud-sdk/path.zsh.inc"
fi

# The next line enables shell command completion for gcloud.
if [ -f "$HOME/Downloads/google-cloud-sdk/completion.zsh.inc" ]; then
    source "$HOME/Downloads/google-cloud-sdk/completion.zsh.inc"
fi

# GKE auth plugin
export USE_GKE_GCLOUD_AUTH_PLUGIN=True

# Company specific settings (commented out by default, enable as needed)
# export VAULT_TEAM=eng-dr-eng
# Add company tools to path if directory exists
if [ -d "$HOME/github/cep-tools/bin/bin" ]; then
    export PATH="$HOME/github/cep-tools/bin/bin:$PATH"
fi

# Add home directory bin
if [ -d "$HOME/bin" ]; then
    export PATH="$HOME/bin:$PATH"
fi

# Source company functions if available
if [ -f "$HOME/github/cep-tools/bash_funcs/source_all" ]; then
    source "$HOME/github/cep-tools/bash_funcs/source_all"
fi

# Custom environment variables
export SGIFNOC_LOADED=true

# GitHub PR function with smart defaults
prq() {
  local title="$1"
  local body="$2"
  local base="${3:-master}"
  
  if [[ -z "$title" ]]; then
    # Try to get title from last commit
    title=$(git log -1 --pretty=format:'%s')
  fi
  
  if [[ -z "$body" ]]; then
    # Generate body from recent commits
    body=$(git log --oneline master..HEAD | sed 's/^[a-f0-9]* /- /')
  fi
  
  echo "Creating PR:"
  echo "  Title: $title"
  echo "  Base: $base"
  echo "  Body: $body"
  echo ""
  
  gh pr create --title "$title" --body "$body" --base "$base"
}

# Local customizations (this will be preserved after updates)
if [ -f "$HOME/.zshrc.local" ]; then
    source "$HOME/.zshrc.local"
fi
